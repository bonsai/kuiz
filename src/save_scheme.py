create_new_file{"filepath": "kuiz/data/firestore-schema.json", "contents": "{\n "$schema": "http://json-schema.org/draft-07/schema#",\n "title": "Firestore Schema Definition",\n "description": "Kuiz アプリケーションの Firestore データベーススキーマ定義",\n "version": "1.0.0",\n "collections": {\n "questions": {\n "description": "クイズ問題のマスタデータ",\n "documentId": "問題 ID (文字列)",\n "schema": {\n "type": "object",\n "required": ["id", "category", "question", "options", "answer"],\n "properties": {\n "id": {\n "type": "integer",\n "description": "問題の一意識別子"\n },\n "category": {\n "type": "string",\n "description": "問題のジャンル/カテゴリ名",\n "examples": ["コンピュータ構成", "データ構造", "ネットワーク", "アルゴリズム", "データベース", "セキュリティ", "OS", "ソフトウェア開発"]\n },\n "question": {\n "type": "string",\n "description": "問題文"\n },\n "options": {\n "type": "array",\n "description": "選択肢の配列（4 択）",\n "items": {\n "type": "string"\n },\n "minItems": 4,\n "maxItems": 4\n },\n "answer": {\n "type": "integer",\n "description": "正解のインデックス（0-origin）",\n "minimum": 0,\n "maximum": 3\n },\n "explanation": {\n "type": "string",\n "description": "解説文（オプショナル）"\n }\n }\n },\n "indexes": [\n {"field": "category", "order": "ASCENDING"}\n ]\n },\n "user_question_state": {\n "description": "ユーザーごとの問題学習状態（FSRS 間隔反復アルゴリズム）",\n "documentId": "{userId}_{questionId}",\n "schema": {\n "type": "object",\n "required": ["userId", "questionId", "repetitions", "interval", "ease", "nextReviewAt", "updatedAt"],\n "properties": {\n "userId": {\n "type": "string",\n "description": "ユーザー ID"\n },\n "questionId": {\n "type": "string",\n "description": "問題 ID"\n },\n "repetitions": {\n "type": "integer",\n "description": "連続正解回数",\n "minimum": 0\n },\n "interval": {\n "type": "integer",\n "description": "次回復習までの間隔（日）",\n "minimum": 1\n },\n "ease": {\n "type": "number",\n "description": "易しさ係数（SM-2 アルゴリズム）",\n "minimum": 1.3,\n "default": 2.5\n },\n "nextReviewAt": {\n "type": "string",\n "format": "date-time",\n "description": "次回復習日時（UTC）"\n },\n "updatedAt": {\n "type": "string",\n "format": "date-time",\n "description": "最終更新日時（UTC）"\n }\n }\n },\n "indexes": [\n {"field": "userId", "order": "ASCENDING"},\n {"field": "nextReviewAt", "order": "ASCENDING"}\n ]\n },\n "answers": {\n "description": "ユーザーの回答履歴",\n "documentId": "自動生成（UUID）",\n "schema": {\n "type": "object",\n "required": ["userId", "questionId", "choice", "correct", "elapsedMs", "createdAt"],\n "properties": {\n "userId": {\n "type": "string",\n "description": "ユーザー ID"\n },\n "questionId": {\n "type": "string",\n "description": "問題 ID"\n },\n "choice": {\n "type": "integer",\n "description": "ユーザーが選択した答えのインデックス（0-origin）",\n "minimum": 0,\n "maximum": 3\n },\n "correct": {\n "type": "boolean",\n "description": "正解かどうか"\n },\n "elapsedMs": {\n "type": "integer",\n "description": "回答にかかった時間（ミリ秒）",\n "minimum": 0\n },\n "createdAt": {\n "type": "string",\n "format": "date-time",\n "description": "回答日時（UTC）"\n }\n }\n },\n "indexes": [\n {"field": "userId", "order": "ASCENDING"},\n {"field": "createdAt", "order": "DESCENDING"},\n {"fields": [{"field": "userId", "order": "ASCENDING"}, {"field": "createdAt", "order": "DESCENDING"}]}\n ]\n },\n "user_stats": {\n "description": "ユーザーごとの学習統計情報",\n "documentId": "{userId}",\n "schema": {\n "type": "object",\n "required": ["userId", "totalAnswers", "correctCount", "totalElapsedMs", "accuracy", "lastAnsweredAt"],\n "properties": {\n "userId": {\n "type": "string",\n "description": "ユーザー ID"\n },\n "totalAnswers": {\n "type": "integer",\n "description": "総回答数",\n "minimum": 0\n },\n "correctCount": {\n "type": "integer",\n "description": "正解数",\n "minimum": 0\n },\n "totalElapsedMs": {\n "type": "integer",\n "description": "総回答時間（ミリ秒）",\n "minimum": 0\n },\n "accuracy": {\n "type": "number",\n "description": "正答率（0.0 〜 1.0）",\n "minimum": 0,\n "maximum": 1\n },\n "lastAnsweredAt": {\n "type": "string",\n "format": "date-time",\n "description": "最終回答日時（UTC）"\n }\n }\n },\n "indexes": []\n }\n },\n "securityRules": {\n "description": "Firestore セキュリティルールの推奨設定",\n "rules": {\n "questions": {\n "read": true,\n "write": "request.auth != null && request.auth.token.admin == true"\n },\n "user_question_state": {\n "read": "request.auth != null && request.auth.uid == resource.data.userId",\n "write": "request.auth != null && request.auth.uid == request.resource.data.userId"\n },\n "answers": {\n "read": "request.auth != null && request.auth.uid == resource.data.userId",\n "write": "request.auth != null && request.auth.uid == request.resource.data.userId"\n },\n "user_stats": {\n "read": "request.auth != null && request.auth.uid == resource.data.userId",\n "write": "request.auth != null && request.auth.uid == request.resource.data.userId"\n }\n }\n },\n "fsrsAlgorithm": {\n "description": "FSRS (Free Spaced Repetition Scheduler) アルゴリズムパラメータ",\n "parameters": {\n "initialEase": 2.5,\n "minimumEase": 1.3,\n "easeAdjustmentFormula": "ease + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02))",\n "qualityMapping": {\n "elapsedMs <= 5000": 5,\n "5000 < elapsedMs <= 12000": 4,\n "elapsedMs > 12000": 3,\n "incorrect": 1\n },\n "intervalRules": {\n "repetitions == 0 (after correct)": 1,\n "repetitions == 1 (after correct)": 6,\n "repetitions >= 2 (after correct)": "interval * ease",\n "incorrect": "reset to 1"\n }\n }\n }\n}\n"} </tool_call>